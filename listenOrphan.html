<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <script type="text/javascript">

    //use blockchain.info api to get live block data
    data = new Object();
    var connection = new WebSocket('wss://ws.blockchain.info/inv');
    connection.onopen = function (event) {
        connection.send('{"op":"blocks_sub"}');
        //connection.send('{"op":"ping_block"}');

        };

        connection.onmessage = function (event) {
            block = eval('(' + event.data + ')');
            console.log('new block found');
            console.log(block);

            var height = block['x']['height']
            block['time'] = new Date();
            if(height in data) {
                data[height].push(block);
            }
            else {
                data[height] = new Array(block);
            }
        };
        connection.onclose = function(event) {
            console.log("closed");
        };

    //ping to keep websocket alive
    setInterval(function() {
        connection.send('ping');
        console.log('pinging');
    }, 59 * 1000);

    function download() {
        var dataDownload = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
        $('#data').html('<a href="data:' + dataDownload + '" download="data.json">download JSON</a>');
    }
    </script>
</head>
<body>
<div id="download">
    <button onclick='download()'>
        Get Data
    </button>
    <br>
    <span id ="data">

    </span>
</div>
</body>
</html>